<view class="container {{theme === 'dark' ? 'theme-dark' : 'theme-light'}}" style="--accent-color: {{accentColor}};" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd">
  <view class="header">
    <view class="nav" bindtap="onPrevMonth" aria-label="{{i18n.accessibilityPrevMonth}}">&lt;</view>
    <picker mode="date" fields="month" value="{{ymValue}}" bindchange="onMonthPicked">
      <view class="title">{{monthLabel}}</view>
    </picker>
    <view class="nav" bindtap="onNextMonth" aria-label="{{i18n.accessibilityNextMonth}}">&gt;</view>
  </view>

  <block wx:if="{{dataLocked}}">
    <view class="locked-card">
      <view class="locked-title">{{i18n.lockedTitle}}</view>
      <view class="locked-hint">{{i18n.lockedHint}}</view>
      <button class="plain" bindtap="goSettings">{{i18n.unlock}}</button>
    </view>
  </block>

  <view class="week">
    <block wx:for="{{weekHeaders}}" wx:key="*this">
      <text class="w">{{item}}</text>
    </block>
  </view>
  <view class="days {{dataLocked ? 'disabled' : ''}}">
    <block wx:for="{{days}}" wx:key="dateKey">
      <view class="day {{item.inMonth ? '' : 'out'}} {{item.isToday ? 'today' : ''}}" style="background-color: {{item.bg}};" data-datekey="{{item.dateKey}}" data-inmonth="{{item.inMonth}}" bindtap="onDayTap" bindlongpress="onDayLongPress">
        <text class="d">{{item.day}}</text>
        <view wx:if="{{item.note}}" class="note-dot"></view>
        <text wx:if="{{item.mood}}" class="mood">{{item.mood}}</text>
      </view>
    </block>
  </view>
  <button class="today-btn" type="default" bindtap="onTodayTap" style="color: {{accentColor}}; border-color: {{accentColor}};">{{i18n.today}}</button>
</view>

<view wx:if="{{pickerVisible}}" class="mask" bindtap="onMaskTap"></view>
<view wx:if="{{pickerVisible}}" class="picker">
  <view class="picker-title">{{i18n.pickTitle}}</view>
  <view class="emoji-grid">
    <block wx:for="{{emojiOptions}}" wx:key="*this">
      <view class="emoji-item" data-mood="{{item}}" bindtap="onChooseEmoji">{{item}}</view>
    </block>
  </view>
  <button class="note-btn" type="default" bindtap="onGoDetailFromPicker">{{i18n.addNote}}</button>
  <button class="clear-btn" type="warn" bindtap="onClearMood">{{i18n.clear}}</button>
</view>

<view class="tools">
  <button size="mini" bindtap="goStats">{{i18n.stats}}</button>
  <button size="mini" bindtap="goSettings">{{i18n.settings}}</button>
  <button size="mini" bindtap="goSearch">{{i18n.search}}</button>
</view>
